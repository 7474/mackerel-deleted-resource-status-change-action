const Mackerel = require("../lib/mackerel");

const APIKEY = "VeHL1XV2/Dod7ZZvucrRnXThLwpv+E/isoieMfHzgKc=";
const mackerel = new Mackerel(APIKEY);

const util = require('util');
const exec = util.promisify(require('child_process').exec);

const gets = [
  mackerel.getServices,
  mackerel.getRoles,
  mackerel.getTags,
  mackerel.getHosts,
];

Promise.all(gets.map((f)=>{
  return f.bind(mackerel)().then((d)=> (d.name = f.name) && d).catch((err)=> (err.name = f.name) && err);
})).then((dat)=>{
  dat.forEach((d)=>{
    console.log(`${d.name}: `, d.body || d.message || d);
  });
}).catch((err)=>{
  console.error(err);
});
